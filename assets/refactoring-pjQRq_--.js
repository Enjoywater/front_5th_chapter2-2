import{r as i,a as w,I as P,j as e,c as R,R as _}from"./constants-UW3oWojX.js";const B=t=>t.reduce((n,s)=>Math.max(n,s.rate),0),W=t=>typeof t=="string",N=t=>t==="amount",Y=(t,n)=>{const s=n.find(a=>a.product.id===t.id);return t.stock-((s==null?void 0:s.quantity)||0)},z=(t,n)=>t.filter(s=>n>=s.quantity).reduce((s,a)=>Math.max(s,a.rate),0),G=t=>{const{discounts:n}=t.product,{quantity:s}=t;return z(n,s)},H=t=>{const{quantity:n,product:{discounts:s}}=t;return s.filter(a=>n>=a.quantity)},J=t=>H(t).sort((a,c)=>c.rate-a.rate)[0],K=t=>{const n=J(t),{quantity:s,product:{price:a}}=t;return n?a*s*(1-n.rate):a*s},X=(t,n)=>{const s=t.reduce((a,c)=>a+K(c),0);return n?N(n.discountType)?Math.max(0,s-n.discountValue):s*(1-n.discountValue/100):s},Z=(t,n)=>{const s=t.reduce((o,r)=>o+r.product.price*r.quantity,0),a=X(t,n),c=s-a;return{totalBeforeDiscount:s,totalAfterDiscount:a,totalDiscount:c}},Q=(t,n)=>{var s;return(s=t.find(a=>a.product.id===n))==null?void 0:s.product},S=(t,n)=>t.filter(s=>s.product.id!==n),k=(t,n,s)=>{if(s<=0)return S(t,n);const a=Q(t,n);return a&&s>a.stock&&(s=a.stock),t.map(c=>c.product.id===n?{...c,quantity:s}:c)},U=()=>{const[t,n]=i.useState([]),[s,a]=i.useState(null),c=i.useCallback(d=>n(l=>{const u=l.find(p=>p.product.id===d.id);return u?k(l,d.id,u.quantity+1):[...l,{product:d,quantity:1}]}),[n]),o=i.useCallback(d=>n(l=>S(l,d)),[n]),r=i.useCallback((d,l)=>n(u=>k(u,d,l)),[n]),m=i.useCallback(d=>a(d),[a]),x=i.useCallback(()=>Z(t,s),[t,s]);return{cart:t,addToCart:c,removeFromCart:o,updateQuantity:r,applyCoupon:m,calculateTotal:x,selectedCoupon:s}},ee=t=>{const[n,s]=i.useState(t);return{coupons:n,addCoupon:c=>s(o=>[...o,c])}},te=t=>{const[n,s]=i.useState(t);return{products:n,updateProduct:o=>s(r=>r.map(m=>m.id===o.id?o:m)),addProduct:o=>s(r=>[...r,o])}},se=()=>{const[t,n]=i.useState(new Set),s=i.useCallback(a=>{n(c=>{const o=new Set(c);return o.has(a)?o.delete(a):o.add(a),o})},[]);return{openProductIds:t,toggleProductAccordion:s}},ne=({products:t,onProductUpdate:n})=>{const[s,a]=i.useState(null),c=i.useCallback(d=>{a({...d})},[]),o=i.useCallback((d,l)=>{if(s&&s.id===d){const u={...s,name:l};a(u)}},[s]),r=i.useCallback((d,l)=>{if(s&&s.id===d){const u={...s,price:l};a(u)}},[s]),m=i.useCallback((d,l)=>{const u=t.find(h=>h.id===d);if(!u)return;const p={...u,stock:l};n(p),a(p)},[t,n]),x=i.useCallback(()=>{s&&(n(s),a(null))},[s,n]);return{editingProduct:s,editProduct:c,updateProductName:o,updateProductPrice:r,updateProductStock:m,editComplete:x}},ae=({products:t,onProductUpdate:n,onUpdateEditingProduct:s})=>{const[a,c]=i.useState({quantity:0,rate:0}),o=i.useCallback(x=>{const d=t.find(u=>u.id===x);if(!d)return;const l={...d,discounts:[...d.discounts,a]};n(l),s(l),c({quantity:0,rate:0})},[t,a,n,s]),r=i.useCallback((x,d)=>{const l=t.find(p=>p.id===x);if(!l)return;const u={...l,discounts:l.discounts.filter((p,h)=>h!==d)};n(u),s(u)},[t,n,s]),m=i.useCallback(({e:x,isRate:d})=>{const l=parseInt(x.target.value);if(!isNaN(l)){if(d){c(u=>({...u,rate:l/100}));return}c(u=>({...u,quantity:l}))}},[]);return{newDiscount:a,addDiscount:o,removeDiscount:r,updateDiscount:m}},ce=({onCouponAdd:t})=>{const[n,s]=i.useState(w),a=i.useCallback(d=>{s(l=>({...l,name:d}))},[]),c=i.useCallback(d=>{s(l=>({...l,code:d}))},[]),o=i.useCallback(d=>{s(l=>({...l,discountType:d}))},[]),r=i.useCallback(d=>{s(l=>({...l,discountValue:d}))},[]),m=i.useCallback(()=>{s(w)},[]),x=i.useCallback(()=>{t(n),m()},[n,t,m]);return{newCoupon:n,updateCouponName:a,updateCouponCode:c,updateCouponDiscountType:o,updateCouponDiscountValue:r,addCoupon:x}},oe=({onProductAdd:t})=>{const[n,s]=i.useState(!1),[a,c]=i.useState(P),o=i.useCallback(()=>{s(u=>!u)},[]),r=i.useCallback(u=>{c(p=>({...p,name:u}))},[]),m=i.useCallback(u=>{c(p=>({...p,price:u}))},[]),x=i.useCallback(u=>{c(p=>({...p,stock:u}))},[]),d=i.useCallback(()=>{c(P),s(!1)},[]),l=i.useCallback(()=>{const u={...a,id:Date.now().toString()};t(u),d()},[a,t,d]);return{newProduct:a,showNewProductForm:n,toggleNewProductForm:o,updateProductName:r,updateProductPrice:m,updateProductStock:x,addNewProduct:l}},le=({option:t})=>W(t)?e.jsx("option",{value:t,children:t}):e.jsx("option",{value:t.value,children:t.label}),de="w-full p-2 border rounded",D=({options:t,value:n,onChange:s,placeholder:a,className:c,disabled:o=!1})=>{const r=m=>{s(m.target.value)};return e.jsxs("select",{value:n,onChange:r,className:de+" "+c,disabled:o,children:[a&&e.jsx("option",{value:"",children:a}),t.map((m,x)=>e.jsx(le,{option:m},x))]})},re=({item:t,updateQuantity:n,removeFromCart:s})=>{const a=G(t);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[`${t.product.price}원 x ${t.quantity}`,a>0&&e.jsx("span",{className:"text-green-600 ml-1",children:`(${(a*100).toFixed(0)}% 할인 적용)`})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>n(t.product.id,t.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:()=>n(t.product.id,t.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>s(t.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]})},ie=({product:t,cart:n,addToCart:s})=>{const a=Y(t,n);return e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[t.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${a>0?"text-green-600":"text-red-600"}`,children:["재고: ",a,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(B(t.discounts)*100).toFixed(0),"% 할인"]})]}),t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((c,o)=>e.jsxs("li",{children:[c.quantity,"개 이상: ",(c.rate*100).toFixed(0),"% 할인"]},o))}),e.jsx("button",{onClick:()=>s(t),className:`w-full px-3 py-1 rounded ${a>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:a<=0,children:a>0?"장바구니에 추가":"품절"})]})},ue=({products:t,coupons:n})=>{const{cart:s,addToCart:a,removeFromCart:c,updateQuantity:o,applyCoupon:r,calculateTotal:m,selectedCoupon:x}=U(),{totalBeforeDiscount:d,totalAfterDiscount:l,totalDiscount:u}=m(),p=i.useMemo(()=>x?n.findIndex(b=>b.code===x.code).toString():"",[x,n]),h=i.useMemo(()=>[{value:"",label:"쿠폰 선택"},...n.map(({name:C,discountType:f,discountValue:j},v)=>({value:v.toString(),label:`${C} - ${N(f)?`${j}원`:`${j}%`}`}))],[n]);return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(b=>e.jsx(ie,{product:b,cart:s,addToCart:a},b.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:s.map(b=>e.jsx(re,{item:b,updateQuantity:o,removeFromCart:c},b.product.id))}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsx(D,{value:p,options:h,onChange:b=>r(n[parseInt(b)]),className:"mb-2",placeholder:"쿠폰 선택"}),x&&e.jsx("p",{className:"text-green-600",children:`적용된 쿠폰: ${x.name}(
                ${N(x.discountType)?`${x.discountValue}원`:`${x.discountValue}%`}
                할인)`})]}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",d.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",u.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",l.toLocaleString(),"원"]})]})]})]})]})]})},me=({newProduct:t,showNewProductForm:n,updateProductName:s,updateProductPrice:a,updateProductStock:c,addNewProduct:o})=>n?e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:t.name,onChange:r=>s(r.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:t.price,onChange:r=>a(parseInt(r.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:t.stock,onChange:r=>c(parseInt(r.target.value)),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:o,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}):null,xe=({product:t,editProduct:n})=>e.jsxs("div",{children:[t.discounts.map((s,a)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[s.quantity,"개 이상 구매 시 ",s.rate*100,"% 할인"]})},a)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>n(t),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]}),pe=({discounts:t,newDiscount:n,onRemove:s,onAdd:a,onUpdateDiscount:c})=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),t.map((o,r)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[o.quantity,"개 이상 구매 시 ",o.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>s(r),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},r)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:n.quantity,onChange:o=>c({e:o,isRate:!1}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:n.rate*100,onChange:o=>c({e:o,isRate:!0}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:a,className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),be=({product:t,editingProduct:n,updateProductName:s,updateProductPrice:a,updateProductStock:c,editComplete:o,newDiscount:r,addDiscount:m,removeDiscount:x,updateDiscount:d})=>e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:n.name,onChange:l=>s(t.id,l.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:n.price,onChange:l=>a(t.id,parseInt(l.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:n.stock,onChange:l=>c(t.id,parseInt(l.target.value)),className:"w-full p-2 border rounded"})]}),e.jsx(pe,{discounts:n.discounts,newDiscount:r,onRemove:l=>x(t.id,l),onAdd:()=>m(t.id),onUpdateDiscount:d}),e.jsx("button",{onClick:o,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}),he=({product:t,editingProduct:n,editProduct:s,updateProductName:a,updateProductPrice:c,updateProductStock:o,editComplete:r,newDiscount:m,addDiscount:x,removeDiscount:d,updateDiscount:l})=>e.jsx("div",{className:"mt-2",children:n&&n.id===t.id?e.jsx(be,{product:t,editingProduct:n,updateProductName:a,updateProductPrice:c,updateProductStock:o,editComplete:r,newDiscount:m,addDiscount:x,removeDiscount:d,updateDiscount:l}):e.jsx(xe,{product:t,editProduct:s})}),ge=({coupons:t})=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:t.map((n,s)=>e.jsxs("div",{"data-testid":`coupon-${s+1}`,className:"bg-gray-100 p-2 rounded",children:[n.name," (",n.code,"):",N(n.discountType)?`${n.discountValue}원`:`${n.discountValue}%`," ","할인"]},s))})]}),je=({newCoupon:t,updateCouponName:n,updateCouponCode:s,updateCouponDiscountType:a,updateCouponDiscountValue:c,addCoupon:o,discountTypeOptions:r})=>e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:t.name,onChange:m=>n(m.target.value),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:t.code,onChange:m=>s(m.target.value),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{options:r,value:t.discountType,onChange:m=>a(m)}),e.jsx("input",{type:"number",placeholder:"할인 값",value:t.discountValue,onChange:m=>c(parseInt(m.target.value)),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:o,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),Ne=["amount","percentage"],Ce=({products:t,coupons:n,onProductUpdate:s,onProductAdd:a,onCouponAdd:c})=>{const{openProductIds:o,toggleProductAccordion:r}=se(),{editingProduct:m,editProduct:x,updateProductName:d,updateProductPrice:l,updateProductStock:u,editComplete:p}=ne({products:t,onProductUpdate:s}),{newDiscount:h,addDiscount:b,removeDiscount:C,updateDiscount:f}=ae({products:t,onProductUpdate:s,onUpdateEditingProduct:x}),{newCoupon:j,updateCouponName:v,updateCouponCode:A,updateCouponDiscountType:T,updateCouponDiscountValue:q,addCoupon:I}=ce({onCouponAdd:c}),{newProduct:F,showNewProductForm:y,toggleNewProductForm:$,updateProductName:O,updateProductPrice:V,updateProductStock:E,addNewProduct:L}=oe({onProductAdd:a});return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx("button",{onClick:$,className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:y?"취소":"새 상품 추가"}),e.jsx(me,{newProduct:F,showNewProductForm:y,updateProductName:O,updateProductPrice:V,updateProductStock:E,addNewProduct:L}),e.jsx("div",{className:"space-y-2",children:t.map((g,M)=>e.jsxs("div",{"data-testid":`product-${M+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>r(g.id),className:"w-full text-left font-semibold",children:[g.name," - ",g.price,"원 (재고: ",g.stock,")"]}),o.has(g.id)&&e.jsx(he,{product:g,editingProduct:m,editProduct:x,updateProductName:d,updateProductPrice:l,updateProductStock:u,editComplete:p,newDiscount:h,addDiscount:b,removeDiscount:C,updateDiscount:f})]},g.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx(je,{newCoupon:j,updateCouponName:v,updateCouponCode:A,updateCouponDiscountType:T,updateCouponDiscountValue:q,addCoupon:I,discountTypeOptions:Ne}),e.jsx(ge,{coupons:n})]})]})]})]})},fe=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],ve=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],ye=()=>{const[t,n]=i.useState(!1),{products:s,updateProduct:a,addProduct:c}=te(fe),{coupons:o,addCoupon:r}=ee(ve);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>n(!t),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:t?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:t?e.jsx(Ce,{products:s,coupons:o,onProductUpdate:a,onProductAdd:c,onCouponAdd:r}):e.jsx(ue,{products:s,coupons:o})})]})};R.createRoot(document.getElementById("root")).render(e.jsx(_.StrictMode,{children:e.jsx(ye,{})}));
